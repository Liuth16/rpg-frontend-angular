<main class="characters-layout">
  <!-- Characters List -->
  <section class="characters-list character-select-background">
    <header class="panel-header">
      <h2 class="panel-title">Seus personagens</h2>
      <button
        pButton
        type="button"
        label="Criar Personagem"
        icon="pi pi-plus"
        class="create-button"
        (click)="openCreateDialog()"
      ></button>
    </header>
    <div class="characters-scroll">
      @if (characters().length === 0) {
      <div class="empty-state">
        <p class="empty-text">Nenhum personagem encontrado.</p>
        <p class="empty-hint">Clique em "Criar Personagem" para come√ßar sua aventura!</p>
      </div>
      } @for (char of characters(); track char.id) {
      <div class="character-card" [class.selected]="selectedCharacter()?.id === char.id">
        <div class="character-header">
          <p-avatar
            [ngClass]="char.char_class.toLowerCase()"
            shape="circle"
            size="large"
            class="character-avatar"
          ></p-avatar>
          <div class="character-info">
            <h3 class="character-name">{{ char.name }}</h3>
            <p class="character-meta">{{ char.race }} ‚Ä¢ {{ char.char_class }}</p>
            <p class="character-level">N√≠vel {{ char.level }}</p>
          </div>
        </div>

        <div class="character-actions">
          <button
            pButton
            type="button"
            label="Detalhes"
            class="action-btn details-btn"
            (click)="viewCharacter(char.id)"
          ></button>
          @if (char.current_campaign) {
          <button
            pButton
            type="button"
            label="Jogar"
            class="action-btn play-btn"
            (click)="goToPlay(char.current_campaign.id)"
          ></button>
          }@else {
          <button
            pButton
            type="button"
            label="Nova Campanha"
            icon="pi pi-plus"
            class="action-btn campaign-btn"
            (click)="openCreateCampaignDialog(char.id)"
          ></button>
          }
        </div>
      </div>
      }
    </div>
  </section>

  <!-- Character Details -->
  @if (selectedCharacter()) {
  <section class="character-details details-background">
    <header class="panel-header">
      <h2 class="panel-title">{{ selectedCharacter().name }}</h2>
      <button
        pButton
        type="button"
        label="Excluir Personagem"
        icon="pi pi-trash"
        class="delete-button"
        (click)="confirmDeleteCharacter(selectedCharacter().id)"
      ></button>
    </header>

    <div class="details-scroll">
      <div class="details-grid">
        <!-- Left column: General Info -->
        <div class="info-section">
          <h3 class="section-title">Informa√ß√µes Gerais</h3>
          <div class="info-group">
            <div class="info-item">
              <span class="info-label">Ra√ßa:</span>
              <span class="info-value">{{ selectedCharacter().race }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Classe:</span>
              <span class="info-value">{{ selectedCharacter().char_class }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">N√≠vel:</span>
              <span class="info-value">{{ selectedCharacter().level }}</span>
            </div>
            <div class="info-item full-width">
              <span class="info-label">Descri√ß√£o:</span>
              <p class="info-description">{{ selectedCharacter().description }}</p>
            </div>
          </div>

          <h3 class="section-title mt-4">Status</h3>
          <div class="info-group">
            <div class="info-item">
              <span class="info-label">Vida:</span>
              <div class="health-display">
                <span class="health-text">
                  {{ selectedCharacter().current_health }} / {{ selectedCharacter().max_health }}
                </span>
                <div class="health-bar-container">
                  <div
                    class="health-bar"
                    [style.width.%]="
                      (selectedCharacter().current_health / selectedCharacter().max_health) * 100
                    "
                  ></div>
                </div>
              </div>
            </div>
            <div class="info-item">
              <span class="info-label">Pontos de Habilidade:</span>
              <span class="info-value highlight">{{ selectedCharacter().skill_points }}</span>
            </div>
          </div>

          <h3 class="section-title mt-4">Campanha Atual</h3>
          @if (selectedCharacter().current_campaign) {
          <div class="campaign-card active">
            <p class="campaign-name">{{ selectedCharacter().current_campaign.campaign_name }}</p>
            <p class="campaign-mode">Modo: {{ selectedCharacter().current_campaign.mode }}</p>
            <button
              pButton
              type="button"
              label="Encerrar Campanha"
              class="end-campaign-btn"
              (click)="
                confirmEndCampaign(selectedCharacter().current_campaign.id, selectedCharacter().id)
              "
            ></button>
          </div>
          } @else {
          <p class="empty-campaign">Sem campanhas ativas no momento.</p>
          }

          <h3 class="section-title mt-4">Campanhas Passadas</h3>
          @if (selectedCharacter().past_campaigns.length > 0) {
          <div class="past-campaigns-list">
            @for (camp of selectedCharacter().past_campaigns; track camp.id) {
            <div class="campaign-card past">
              <span class="campaign-name">{{ camp.campaign_name }}</span>
              <span class="campaign-mode">{{ camp.mode }}</span>
            </div>
            }
          </div>
          } @else {
          <p class="empty-campaign">Nenhuma campanha passada.</p>
          }
        </div>

        <!-- Right column: Attributes -->
        <div class="info-section">
          <h3 class="section-title">Atributos</h3>
          <div class="attributes-display">
            <div class="attribute-card">
              <div class="attr-icon">‚öîÔ∏è</div>
              <div class="attr-info">
                <span class="attr-label">For√ßa</span>
                <span class="attr-value">{{ selectedCharacter().attributes?.strength }}</span>
              </div>
            </div>
            <div class="attribute-card">
              <div class="attr-icon">üèπ</div>
              <div class="attr-info">
                <span class="attr-label">Destreza</span>
                <span class="attr-value">{{ selectedCharacter().attributes?.dexterity }}</span>
              </div>
            </div>
            <div class="attribute-card">
              <div class="attr-icon">üìñ</div>
              <div class="attr-info">
                <span class="attr-label">Intelig√™ncia</span>
                <span class="attr-value">{{ selectedCharacter().attributes?.intelligence }}</span>
              </div>
            </div>
            <div class="attribute-card">
              <div class="attr-icon">‚ú®</div>
              <div class="attr-info">
                <span class="attr-label">Carisma</span>
                <span class="attr-value">{{ selectedCharacter().attributes?.charisma }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  }
</main>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
