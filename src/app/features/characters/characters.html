<main class="characters-layout">
  <!-- Characters List -->
  <section class="characters-list character-select-background">
    <header class="panel-header">
      <h2 class="text-lg font-bold mb-4">Seus personagens</h2>
      <button
        pButton
        type="button"
        label="Criar Personagem"
        icon="pi pi-plus"
        class="blz-button"
        (click)="openCreateDialog()"
      ></button>
    </header>
    <div class="panel-content flex flex-col gap-3 overflow-y-auto p-4">
      @if (characters().length === 0) {
      <p>No characters found.</p>
      } @for (char of characters(); track char.id) {
      <p-card class="character-card mb-4">
        <ng-template pTemplate="header">
          <div class="flex items-center p-4 gap-3">
            <p-avatar
              [ngClass]="char.char_class.toLowerCase()"
              shape="circle"
              size="xlarge"
            ></p-avatar>

            <div class="text-xl font-semibold">{{ char.name }}</div>
          </div>
        </ng-template>
        <p><strong>Raça:</strong> {{ char.race }}</p>
        <p><strong>Classe:</strong> {{ char.char_class }}</p>
        <p><strong>Nível:</strong> {{ char.level }}</p>
        <ng-template pTemplate="footer">
          <div class="flex justify-center align-center gap-2">
            <button
              pButton
              type="button"
              label="Detalhes"
              class="cursor-pointer w-32 blz-button"
              (click)="viewCharacter(char.id)"
            ></button>
            @if (char.current_campaign) {
            <button
              pButton
              type="button"
              label="Jogar"
              class="cursor-pointer w-24 blz-button"
              (click)="goToPlay(char.current_campaign.id)"
            ></button>
            }@else {
            <button
              pButton
              type="button"
              label="Criar Campanha"
              icon="pi pi-plus"
              class="cursor-pointer w-40 blz-button"
              (click)="openCreateCampaignDialog(char.id)"
            ></button>
            }
          </div>
        </ng-template>
      </p-card>
      }
    </div>
  </section>

  <!-- Character Details -->
  <div class="character-details">
    @if (selectedCharacter()) {
    <section class="character-details details-background">
      <header class="panel-header flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Detalhes do Personagem</h2>
        <button
          pButton
          type="button"
          label="Excluir Personagem"
          class="cursor-pointer blz-button"
          (click)="confirmDeleteCharacter(selectedCharacter().id)"
        ></button>
      </header>

      <!-- Two-column layout -->
      <div class="panel-content p-6 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Left column: General Info -->
        <div class="space-y-3">
          <h3 class="text-lg font-semibold border-b border-gray-500 pb-1">Informações Gerais</h3>
          <p><span class="font-semibold">Raça:</span> {{ selectedCharacter().race }}</p>
          <p><span class="font-semibold">Classe:</span> {{ selectedCharacter().char_class }}</p>
          <p><span class="font-semibold">Descrição:</span> {{ selectedCharacter().description }}</p>
          <p><span class="font-semibold">Nivel:</span> {{ selectedCharacter().level }}</p>
          <p>
            <span class="font-semibold">Vida:</span>
            {{ selectedCharacter().current_health }} / {{ selectedCharacter().max_health }}
          </p>
          <p>
            <span class="font-semibold">Pontos de Habilidade:</span>
            {{ selectedCharacter().skill_points }}
          </p>

          <div class="mt-4">
            <h3 class="text-lg font-semibold border-b border-gray-500 pb-1">Campanha Atual</h3>
            @if (selectedCharacter().current_campaign) {
            <p class="mt-1">
              {{ selectedCharacter().current_campaign.campaign_name }}
              <span class="italic">(Modo: {{ selectedCharacter().current_campaign.mode }})</span>
            </p>
            <button
              pButton
              type="button"
              label="Encerrar Campanha"
              class="cursor-pointer blz-button"
              (click)="
                confirmEndCampaign(selectedCharacter().current_campaign.id, selectedCharacter().id)
              "
            ></button>
            } @else {
            <p class="mt-1 italic">Sem campanhas ativas.</p>
            }
          </div>

          <div class="mt-4">
            <h3 class="text-lg font-semibold border-b border-gray-500 pb-1">Campanhas passadas</h3>
            @if (selectedCharacter().past_campaigns.length > 0) {
            <ul class="list-disc list-inside mt-1 space-y-1">
              @for (camp of selectedCharacter().past_campaigns; track camp.id) {
              <li>
                {{ camp.campaign_name }} <span class="italic">({{ camp.mode }})</span>
              </li>
              }
            </ul>
            } @else {
            <p class="mt-1 italic text-gray-300">Sem campanhas passadas.</p>
            }
          </div>
        </div>

        <!-- Right column: Attributes -->
        <div class="space-y-3">
          <h3 class="text-lg font-semibold border-b border-gray-500 pb-1">Atributos</h3>
          <div class="grid grid-cols-2 gap-y-2">
            <p>
              <span class="font-semibold">Força:</span>
              {{ selectedCharacter().attributes?.strength }}
            </p>
            <p>
              <span class="font-semibold">Destreza:</span>
              {{ selectedCharacter().attributes?.dexterity }}
            </p>
            <p>
              <span class="font-semibold">Inteligencia:</span>
              {{ selectedCharacter().attributes?.intelligence }}
            </p>
            <p>
              <span class="font-semibold">Carisma:</span>
              {{ selectedCharacter().attributes?.charisma }}
            </p>
          </div>
        </div>
      </div>
    </section>
    }
  </div>
</main>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
